<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>è¡—ãªã‹ãƒªãƒãƒ™å®Ÿè·µã‚»ãƒŸãƒŠãƒ¼ ãƒ¡ãƒ³ã‚¿ãƒ¼ãƒŠãƒ“</title>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; background:#f5f7fb; color:#0b1a3a; }
  header { padding:24px 16px; text-align:center; font-weight:800; font-size:clamp(20px,4vw,40px); }
  main { max-width:900px; margin:0 auto; padding:16px; }
  textarea { width:100%; min-height:140px; border-radius:12px; border:1px solid #cfd6ea; padding:12px; font-size:16px; }
  button { border:0; border-radius:12px; padding:12px 18px; background:#0b5cff; color:#fff; font-weight:700; margin-top:12px; cursor:pointer; }
  .response { background:#fff; border:1px solid #e2e8f0; border-radius:12px; margin-top:16px; padding:14px; min-height:42px; }
  small { color:#475569; }
</style>
</head>
<body>
  <header>ğŸ§­ è¡—ãªã‹ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè·µã‚»ãƒŸãƒŠãƒ¼<br>ãƒ¡ãƒ³ã‚¿ãƒ¼ãƒŠãƒ“</header>
  <main>
    <p><small>è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹ï¼šã€Œäº‹æ¥­è¨ˆç”»ã®ä½œã‚Šæ–¹ã‚’æ•™ãˆã¦ã€ï¼‰</small></p>
    <textarea id="userInput" placeholder="ã“ã“ã«è³ªå•ã‚’å…¥åŠ›â€¦"></textarea>
    <button onclick="sendMessage()">é€ä¿¡</button>
    <div id="response" class="response"></div>
  </main>

<script>
  // ãƒŠãƒ“ã•ã‚“ã®äººæ ¼ï¼ˆå¿…è¦ãªã‚‰æ–‡è¨€ã‚’å¥½ãã«å¤‰ãˆã¦OKï¼‰
  const PERSONA = `
ã‚ãªãŸã¯ã€Œè¡—ãªã‹ãƒªãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè·µã‚»ãƒŸãƒŠãƒ¼ã€ã®å…¬å¼AIãƒ¡ãƒ³ã‚¿ãƒ¼â€œãƒŠãƒ“ã•ã‚“â€ã§ã™ã€‚
ã‚„ã•ã—ãã€åˆ†ã‹ã‚Šã‚„ã™ãã€æœ€å¾Œã«ã€Œæ¬¡ã®ä¸€æ‰‹ã€ã‚’2ã€œ3å€‹ã ã‘ææ¡ˆã—ã¾ã™ã€‚`;

  async function sendMessage() {
    const input = document.getElementById("userInput").value.trim();
    const box = document.getElementById("response");
    if (!input) return;
    box.textContent = "ğŸ’¬ å›ç­”ä¸­ã§ã™â€¦";

    try {
      const res = await fetch("/api/chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ system: PERSONA, user: input })
      });
      const data = await res.json();
      box.innerHTML = (data.reply || "è¿”ç­”ãŒå–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ").replace(/\n/g,"<br>");
      // èª­ã¿ä¸Šã’ï¼ˆå¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶ã®ã¿ï¼‰
      if ('speechSynthesis' in window) {
        const u = new SpeechSynthesisUtterance(box.textContent);
        speechSynthesis.cancel(); speechSynthesis.speak(u);
      }
    } catch (e) {
      box.textContent = "âš ï¸ é€šä¿¡ã‚¨ãƒ©ãƒ¼ï¼š" + e.message;
    }
  }
</script>
</body>
</html>
